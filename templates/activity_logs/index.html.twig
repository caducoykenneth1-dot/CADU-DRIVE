{% extends 'admin/layout.html.twig' %}

{% block admin_title %}Activity Logs{% endblock %}

{% block stylesheets %}
{{ parent() }}
<link rel="stylesheet" href="https://cdn.datatables.net/2.0.7/css/dataTables.dataTables.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

<style>
    .activity-logs-container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 2.5rem 1.5rem;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', sans-serif;
        color: #0f172a !important;
        background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
        min-height: 100vh;
    }
    
    .back-link {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        color: #64748b !important;
        text-decoration: none;
        font-size: 0.875rem;
        font-weight: 600;
        margin-bottom: 1.5rem;
        transition: all 0.2s ease;
    }
    
    .back-link:hover {
        color: #0f172a !important;
        transform: translateX(-2px);
    }
    
    .page-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
        flex-wrap: wrap;
        gap: 1rem;
    }
    
    .page-header h1 {
        font-size: 2rem;
        font-weight: 700;
        color: #0f172a !important;
        margin: 0;
        letter-spacing: -0.03em;
    }
    
    .page-subtitle {
        color: #64748b !important;
        font-size: 0.9375rem;
        margin-top: 0.25rem;
        font-weight: 500;
    }
    
    .total-badge {
        display: inline-flex;
        align-items: center;
        padding: 0.625rem 1.25rem;
        background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
        border: 1px solid #e2e8f0;
        border-radius: 8px;
        font-size: 0.875rem;
        font-weight: 600;
        color: #0f172a !important;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }
    
    .table-card {
        background: white;
        border: 1px solid #e2e8f0;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    }
    
    /* DataTables Wrapper */
    .dataTables_wrapper {
        padding: 1.5rem;
    }
    
    .dataTables_filter {
        float: right;
        margin-bottom: 1.25rem;
    }
    
    .dataTables_filter label {
        font-size: 0.875rem;
        font-weight: 600;
        color: #334155 !important;
        display: flex;
        align-items: center;
        gap: 0.625rem;
    }
    
    .dataTables_filter input {
        border: 1.5px solid #cbd5e1;
        border-radius: 8px;
        padding: 0.625rem 1rem;
        font-size: 0.875rem;
        color: #0f172a !important;
        background: white;
        transition: all 0.2s ease;
        margin-left: 0;
        min-width: 250px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
        font-weight: 500;
    }
    
    .dataTables_filter input:focus {
        outline: none;
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.15), 0 1px 3px rgba(0, 0, 0, 0.08);
    }
    
    .dataTables_filter input::placeholder {
        color: #94a3b8 !important;
        font-weight: 500;
    }
    
    .dataTables_length {
        float: left;
        margin-bottom: 1.25rem;
    }
    
    .dataTables_length label {
        font-size: 0.875rem;
        font-weight: 600;
        color: #334155 !important;
        display: flex;
        align-items: center;
        gap: 0.625rem;
    }
    
    .dataTables_length select {
        border: 1.5px solid #cbd5e1;
        border-radius: 8px;
        padding: 0.625rem 2.5rem 0.625rem 1rem;
        font-size: 0.875rem;
        color: #0f172a !important;
        background: white url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%2364748b' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M6 8l4 4 4-4'/%3e%3c/svg%3e") no-repeat right 0.5rem center/1.25em 1.25em;
        margin: 0;
        cursor: pointer;
        appearance: none;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
        transition: all 0.15s ease;
        font-weight: 600;
    }
    
    .dataTables_length select:hover {
        border-color: #94a3b8;
    }
    
    .dataTables_length select:focus {
        outline: none;
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.15);
    }
    
    .dataTables_info {
        color: #64748b !important;
        font-size: 0.875rem;
        padding-top: 1.25rem;
        font-weight: 600;
    }
    
    .dataTables_paginate {
        padding-top: 1.25rem;
        display: flex;
        gap: 0.25rem;
        justify-content: flex-end;
    }
    
    .paginate_button {
        border: 1.5px solid #e2e8f0;
        color: #334155 !important;
        background: white;
        margin: 0;
        border-radius: 8px;
        padding: 0.5rem 0.875rem;
        font-size: 0.875rem;
        font-weight: 600;
        transition: all 0.2s ease;
        cursor: pointer;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
    }
    
    .paginate_button.current {
        background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
        color: white !important;
        border-color: #0f172a;
        box-shadow: 0 2px 4px rgba(15, 23, 42, 0.2);
    }
    
    .paginate_button:hover:not(.disabled):not(.current) {
        background: #f1f5f9;
        border-color: #94a3b8;
        color: #0f172a !important;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        transform: translateY(-1px);
    }
    
    .paginate_button.disabled {
        opacity: 0.4;
        cursor: not-allowed;
    }
    
    .paginate_button.disabled:hover {
        background: white;
        border-color: #e2e8f0;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
        transform: none;
    }
    
    /* Table Styles */
    .logs-table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
        font-size: 0.875rem;
    }
    
    .logs-table thead th {
        background: linear-gradient(to bottom, #f8fafc, #f1f5f9);
        text-align: left;
        padding: 1rem 1.25rem;
        font-weight: 700;
        font-size: 0.8125rem;
        color: #334155 !important;
        border-bottom: 2px solid #cbd5e1;
        white-space: nowrap;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        cursor: pointer;
        user-select: none;
        transition: background 0.15s ease;
    }
    
    .logs-table thead th:hover {
        background: linear-gradient(to bottom, #f1f5f9, #e2e8f0);
    }
    
    .logs-table thead th.sorting:before,
    .logs-table thead th.sorting_asc:before,
    .logs-table thead th.sorting_desc:before {
        opacity: 0.3;
    }
    
    .logs-table tbody td {
        padding: 1rem 1.25rem;
        border-bottom: 1px solid #f3f4f6;
        vertical-align: middle;
        background: white;
    }
    
    .logs-table tbody tr:last-child td {
        border-bottom: none;
    }
    
    .logs-table tbody tr {
        transition: all 0.15s ease;
    }
    
    .logs-table tbody tr:hover {
        background: #f8fafc;
        box-shadow: 0 2px 8px rgba(15, 23, 42, 0.08);
        transform: scale(1.001);
    }
    
    .logs-table tbody tr:hover td {
        background: transparent;
    }
    
    /* User Cell */
    .user-cell {
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }
    
    .user-icon {
        width: 36px;
        height: 36px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 6px;
        font-size: 1rem;
        flex-shrink: 0;
    }
    
    .user-icon.admin {
        background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
        color: #dc2626 !important;
        box-shadow: 0 2px 4px rgba(220, 38, 38, 0.15);
    }
    
    .user-icon.staff {
        background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
        color: #d97706 !important;
        box-shadow: 0 2px 4px rgba(217, 119, 6, 0.15);
    }
    
    .user-icon.user {
        background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
        color: #059669 !important;
        box-shadow: 0 2px 4px rgba(5, 150, 105, 0.15);
    }
    
    .user-icon.guest {
        background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
        color: #64748b !important;
        box-shadow: 0 2px 4px rgba(100, 116, 139, 0.1);
    }
    
    .user-info {
        min-width: 0;
    }
    
    .user-type {
        font-weight: 600;
        font-size: 0.875rem;
        color: #0f172a !important;
        margin-bottom: 0.125rem;
        letter-spacing: -0.01em;
    }
    
    .username {
        font-size: 0.8125rem;
        color: #64748b !important;
        font-weight: 500;
    }
    
    /* Action Cell */
    .action-cell {
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }
    
    .action-icon {
        width: 36px;
        height: 36px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 6px;
        font-size: 1rem;
        flex-shrink: 0;
    }
    
    .action-icon.login {
        background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
        color: #059669 !important;
        box-shadow: 0 2px 4px rgba(5, 150, 105, 0.15);
    }
    
    .action-icon.logout {
        background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
        color: #64748b !important;
        box-shadow: 0 2px 4px rgba(100, 116, 139, 0.1);
    }
    
    .action-icon.create {
        background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
        color: #3b82f6 !important;
        box-shadow: 0 2px 4px rgba(59, 130, 246, 0.15);
    }
    
    .action-icon.update {
        background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
        color: #d97706 !important;
        box-shadow: 0 2px 4px rgba(217, 119, 6, 0.15);
    }
    
    .action-icon.delete {
        background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
        color: #dc2626 !important;
        box-shadow: 0 2px 4px rgba(220, 38, 38, 0.15);
    }
    
    .action-icon.default {
        background: linear-gradient(135deg, #fae8ff 0%, #f3e8ff 100%);
        color: #9333ea !important;
        box-shadow: 0 2px 4px rgba(147, 51, 234, 0.15);
    }
    
    .action-name {
        font-weight: 600;
        font-size: 0.875rem;
        color: #0f172a !important;
        letter-spacing: -0.01em;
    }
    
    /* Details Cell */
    .details-cell {
        max-width: 300px;
    }
    
    .details-text {
        font-size: 0.875rem;
        line-height: 1.6;
        color: #475569 !important;
        overflow: hidden;
        text-overflow: ellipsis;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        font-weight: 500;
    }
    
    /* Timestamp Cell */
    .timestamp-cell {
        font-family: 'SF Mono', 'Monaco', 'Consolas', monospace;
        font-size: 0.8125rem;
        white-space: nowrap;
    }
    
    .date {
        display: block;
        font-weight: 600;
        color: #0f172a !important;
        margin-bottom: 0.25rem;
        letter-spacing: -0.01em;
    }
    
    .time {
        display: block;
        color: #64748b !important;
        font-weight: 500;
    }
    
    /* Empty State */
    .empty-state {
        text-align: center;
        padding: 4rem 2rem;
        color: #9ca3af !important;
    }
    
    .empty-icon {
        font-size: 3rem;
        margin-bottom: 1rem;
        opacity: 0.3;
    }
    
    .empty-state h4 {
        font-size: 1.125rem;
        font-weight: 700;
        color: #334155 !important;
        margin-bottom: 0.5rem;
        letter-spacing: -0.01em;
    }
    
    .empty-state p {
        font-size: 0.875rem;
        color: #94a3b8 !important;
        font-weight: 500;
    }
    
    @media (max-width: 768px) {
        .activity-logs-container {
            padding: 1.5rem 1rem;
        }
        
        .page-header {
            flex-direction: column;
            align-items: flex-start;
        }
        
        .page-header h1 {
            font-size: 1.5rem;
        }
        
        .dataTables_wrapper {
            padding: 1rem;
        }
        
        .dataTables_filter,
        .dataTables_length {
            float: none;
            margin-bottom: 1rem;
        }
        
        .table-card {
            overflow-x: auto;
        }
        
        .logs-table {
            min-width: 800px;
        }
        
        .details-cell {
            max-width: 200px;
        }
    }

    #activityLogsTable_wrapper * {
    color: #0f172a !important;
}

/* But keep placeholder text gray */
#activityLogsTable_wrapper input::placeholder {
    color: #64748b !important;
}

/* Make pagination buttons have consistent text */
#activityLogsTable_wrapper .paginate_button {
    color: #0f172a !important;
}

/* Current page button should have white text on black */
#activityLogsTable_wrapper .paginate_button.current {
    color: white !important;
}

/* Disabled buttons */
#activityLogsTable_wrapper .paginate_button.disabled {
    color: #94a3b8 !important;
}
    
</style>
{% endblock %}

{% block admin_content %}
<div class="activity-logs-container">
    <a href="{{ path('app_admin_profile') }}" class="back-link">
        <i class="bi bi-arrow-left"></i>
        Back to Profile
    </a>
    
    <header class="page-header">
        <div>
            <h1>Activity Logs</h1>
            <p class="page-subtitle">Monitor all system activities in real-time</p>
        </div>
        <div class="total-badge">
            <strong>{{ logs|length }}</strong>&nbsp;Total Entries
        </div>
    </header>
    
    <div class="table-card">
        <table class="table logs-table" id="activityLogsTable">
            <thead>
                <tr>
                    <th>User</th>
                    <th>Action</th>
                    <th>Details</th>
                    <th>Timestamp</th>
                </tr>
            </thead>
            <tbody>
                {% for log in logs %}
                <tr>
                    <!-- User -->
                    <td>
                        <div class="user-cell">
                            {% if log.userType == 'ADMIN' %}
                                <div class="user-icon admin">
                                    <i class="bi bi-shield-fill"></i>
                                </div>
                            {% elseif log.userType == 'STAFF' %}
                                <div class="user-icon staff">
                                    <i class="bi bi-person-badge"></i>
                                </div>
                            {% elseif log.userType == 'USER' %}
                                <div class="user-icon user">
                                    <i class="bi bi-person-fill"></i>
                                </div>
                            {% else %}
                                <div class="user-icon guest">
                                    <i class="bi bi-person"></i>
                                </div>
                            {% endif %}
                            <div class="user-info">
                                <div class="user-type">{{ log.userType|default('GUEST') }}</div>
                                {% if log.username %}
                                    <div class="username">{{ log.username|split('@')|first }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </td>

                    <!-- Action -->
                    <td>
                        <div class="action-cell">
                            {% set actionLower = log.action|lower %}
                            {% if 'login' in actionLower %}
                                <div class="action-icon login">
                                    <i class="bi bi-box-arrow-in-right"></i>
                                </div>
                            {% elseif 'logout' in actionLower %}
                                <div class="action-icon logout">
                                    <i class="bi bi-box-arrow-right"></i>
                                </div>
                            {% elseif 'create' in actionLower %}
                                <div class="action-icon create">
                                    <i class="bi bi-plus-circle"></i>
                                </div>
                            {% elseif 'update' in actionLower %}
                                <div class="action-icon update">
                                    <i class="bi bi-pencil-square"></i>
                                </div>
                            {% elseif 'delete' in actionLower %}
                                <div class="action-icon delete">
                                    <i class="bi bi-trash"></i>
                                </div>
                            {% else %}
                                <div class="action-icon default">
                                    <i class="bi bi-activity"></i>
                                </div>
                            {% endif %}
                            <div class="action-name">
                                {{ log.action|replace({'_': ' '})|title }}
                            </div>
                        </div>
                    </td>

                    <!-- Details -->
                    <td>
                        <div class="details-cell">
                            <div class="details-text" title="{{ log.targetData }}">
                                {% if log.targetData %}
                                    {{ log.targetData }}
                                {% else %}
                                    <span style="color: #94a3b8 !important; font-style: italic;">No details available</span>
                                {% endif %}
                            </div>
                        </div>
                    </td>

                    <!-- Timestamp -->
                    <td>
                        <div class="timestamp-cell">
                            <span class="date">{{ log.createdAt|date('Y-m-d') }}</span>
                            <span class="time">{{ log.createdAt|date('H:i:s') }}</span>
                        </div>
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="4">
                        <div class="empty-state">
                            <div class="empty-icon">
                                <i class="bi bi-clock-history"></i>
                            </div>
                            <h4>No Activity Logs Found</h4>
                            <p>System activities will appear here as they occur</p>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}

{% block javascripts %}
{{ parent() }}
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.datatables.net/2.0.7/js/dataTables.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    $('#activityLogsTable').DataTable({
        pageLength: 5,
        lengthMenu: [[5, 10, 25, 50, 100], [5, 10, 25, 50, 100]],
        order: [[3, 'desc']],
        language: {
            search: "Search:",
            lengthMenu: "Show _MENU_ entries",
            info: "Showing _START_ to _END_ of _TOTAL_ entries",
            infoEmpty: "No entries to show",
            infoFiltered: "(filtered from _MAX_ total)",
            paginate: {
                first: "First",
                last: "Last",
                next: "Next",
                previous: "Prev"
            },
            zeroRecords: "No matching records found"
        },
        responsive: true,
        stateSave: false,
        columnDefs: [
            { orderable: true, targets: [0, 1, 3] },
            { orderable: false, targets: [2] }
        ],
        dom: '<"row"<"col-sm-6"l><"col-sm-6"f>>rt<"row"<"col-sm-6"i><"col-sm-6"p>>'
    });
});
</script>
{% endblock %}