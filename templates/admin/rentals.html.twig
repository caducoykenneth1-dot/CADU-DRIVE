{% extends 'admin/layout.html.twig' %}

{% block admin_title %}Rental Requests{% endblock %}

{% block admin_content %}
    <section id="rental-requests" class="dashboard-section" data-dashboard-section>
        <div class="section-header">
            <div>
                <h2>Rental Requests Timeline</h2>
                <p>Latest customer rental requests with status visibility.</p>
            </div>
            <div class="section-actions">
                <a href="{{ path('app_staff_rental_requests') }}" class="section-link">
                    <span class="bi bi-clipboard-check"></span>
                    Manage All Requests
                </a>
            </div>
        </div>

        {% if rentalRequests is defined and rentalRequests is not empty %}
            <div class="timeline">
                {% set nowDate = date() %}
                {% for request in rentalRequests %}
                    {% set isPending = request.status == 'pending' %}
                    {% set isApproved = request.status == 'approved' %}
                    {% set isRejected = request.status == 'rejected' %}
                    
                    <div class="timeline-item">
                        <span class="timeline-dot 
                            {% if isPending %}timeline-dot-warning{% endif %}
                            {% if isApproved %}timeline-dot-success{% endif %}
                            {% if isRejected %}timeline-dot-danger{% endif %}
                        "></span>
                        <div class="timeline-content">
                            <h4>{{ request.car ? request.car.make ~ ' ' ~ request.car.model : 'Vehicle' }}</h4>
                            <p>
                                <span class="bi bi-person"></span>
                                {{ request.customer ? request.customer.displayName : 'Customer' }}
                            </p>
                            <div class="meta">
                                <span>
                                    <span class="bi bi-calendar"></span>
                                    {{ request.startDate|date('M d, Y') }} to {{ request.endDate|date('M d, Y') }}
                                </span>
                                <span>
                                    {% if isPending %}
                                        <span class="status-badge is-amber">Pending</span>
                                    {% elseif isApproved %}
                                        <span class="status-badge is-green">Approved</span>
                                    {% elseif isRejected %}
                                        <span class="status-badge is-red">Rejected</span>
                                    {% endif %}
                                </span>
                            </div>
                            {% if request.notes %}
                            <div class="notes">
                                <small><span class="bi bi-chat-left"></span> {{ request.notes|slice(0, 50) }}{% if request.notes|length > 50 %}...{% endif %}</small>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="empty-placeholder">
                <strong>No rental requests yet</strong>
                Customer rental requests will appear here once submitted.
            </div>
        {% endif %}
    </section>
{% endblock %}