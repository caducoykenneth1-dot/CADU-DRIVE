{% extends 'base.html.twig' %}

{% block title %}Car Index{% endblock %}

{% block body %}
<div class="container py-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="page-title mb-0 text-center w-100">Our Fleet</h1>
    </div>

    <div class="car-grid">
        {% for car in cars %}
            {% set status_code = car.status.code|default('unknown') %}
            <article class="car-card">
                <div class="car-card-image">
                    {% if car.image %}
                        <img src="{{ asset('images/' ~ car.image) }}" alt="{{ car.make }} {{ car.model }}">
                    {% else %}
                        <img src="https://placehold.co/600x400/1f2937/adb5bd?text={{ car.make|escape('url') }}" alt="{{ car.make }} {{ car.model }}">
                    {% endif %}
                </div>

                <div class="card-body">
                    <header class="card-header">
                        <div class="card-title-group">
                            <h3 class="card-title">{{ car.make }} {{ car.model }}</h3>
                            <p class="card-subtitle">Year {{ car.year }}</p>
                        </div>
                        <span class="badge {{ status_code == 'available' ? 'bg-success' : 'bg-danger' }}">
                            {{ car.status.label|default('Unknown') }}
                        </span>
                    </header>

                    <p class="card-price">
                        &#8369;{{ car.price|number_format(0, '.', ',') }}
                        <span>/day</span>
                    </p>

                    <p class="description">
                        {{ car.description ? car.description|slice(0, 120) ~ (car.description|length > 120 ? 'â€¦' : '') : 'No description available for this vehicle yet.' }}
                    </p>

                <div class="card-actions">
    <a href="{{ path('app_car_show', {'id': car.id}) }}" class="btn btn-compact btn-details">
        View Details
    </a>
    
    {% if car.status.code == 'available' %}
        {% if is_granted('PUBLIC_ACCESS') %}
            <a href="{{ path('app_rental_request_new', {'id': car.id}) }}" class="btn btn-primary">
                Rent This Car
            </a>
        {% elseif is_granted('ROLE_ADMIN') or is_granted('ROLE_STAFF') %}
            <span class="btn btn-secondary disabled" aria-disabled="true">
                Staff/Admin View Only
            </span>
        {% endif %}
    {% else %}
        <span class="unavailable-note">
            Currently unavailable. Check back soon!
        </span>
    {% endif %}
</div>
 </div>
    </article>
        {% else %}
           <p class="no-cars-message">No cars available at the moment. Please check back later.</p>
        {% endfor %}
    </div>
</div>
{% endblock %}
